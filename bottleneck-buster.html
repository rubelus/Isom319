<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bottleneck Buster | ISOM 319 Operations Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --primary-glow: rgba(255, 107, 53, 0.4);
            --secondary: #00D4AA;
            --secondary-glow: rgba(0, 212, 170, 0.4);
            --warning: #FFD23F;
            --danger: #FF4757;
            --dark: #0D1117;
            --darker: #080B0F;
            --surface: #161B22;
            --surface-light: #21262D;
            --text: #E6EDF3;
            --text-muted: #8B949E;
            --bottleneck: #FF4757;
            --capacity-high: #00D4AA;
            --capacity-med: #FFD23F;
            --capacity-low: #FF4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--darker);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 107, 53, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 107, 53, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 107, 53, 0.2);
            margin-bottom: 24px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, #FF8F6B 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 20px var(--primary-glow);
        }

        .logo-text h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--warning) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 2px;
        }

        .stats-bar {
            display: flex;
            gap: 24px;
        }

        .stat {
            text-align: center;
            padding: 10px 20px;
            background: var(--dark);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-value.score {
            color: var(--secondary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Game Area */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
        }

        .main-panel {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .level-header {
            padding: 20px 30px;
            background: linear-gradient(90deg, rgba(255, 107, 53, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .level-info h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .level-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .timer {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--warning);
            padding: 8px 16px;
            background: rgba(255, 210, 63, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 210, 63, 0.3);
        }

        /* Process Flow Visualization */
        .process-area {
            padding: 40px 30px;
            min-height: 400px;
        }

        .scenario-description {
            background: var(--dark);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid var(--primary);
        }

        .scenario-description h3 {
            color: var(--primary);
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .scenario-description p {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .process-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            flex-wrap: wrap;
            padding: 20px 0;
        }

        .station {
            position: relative;
            width: 140px;
            padding: 20px 15px;
            background: var(--surface-light);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .station:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.2);
        }

        .station.selected {
            border-color: var(--secondary);
            box-shadow: 0 0 30px var(--secondary-glow);
        }

        .station.bottleneck-reveal {
            border-color: var(--bottleneck);
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.4);
            animation: pulse-bottleneck 1s infinite;
        }

        @keyframes pulse-bottleneck {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 71, 87, 0.4); }
            50% { box-shadow: 0 0 50px rgba(255, 71, 87, 0.6); }
        }

        .station.correct {
            border-color: var(--secondary);
            background: rgba(0, 212, 170, 0.1);
        }

        .station.incorrect {
            border-color: var(--danger);
            background: rgba(255, 71, 87, 0.1);
        }

        .station-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .station-name {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 12px;
            color: var(--text);
        }

        .station-capacity {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .station-capacity-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .capacity-bar {
            width: 100%;
            height: 6px;
            background: var(--dark);
            border-radius: 3px;
            margin-top: 12px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .capacity-fill.high { background: var(--capacity-high); }
        .capacity-fill.med { background: var(--capacity-med); }
        .capacity-fill.low { background: var(--capacity-low); }

        .arrow {
            font-size: 1.5rem;
            color: var(--text-muted);
            padding: 0 10px;
        }

        .arrow.flow-active {
            color: var(--secondary);
            animation: flow-pulse 1s infinite;
        }

        @keyframes flow-pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Multi-product indicator */
        .product-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .product-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .product-dot.a { background: var(--primary); }
        .product-dot.b { background: var(--secondary); }
        .product-dot.c { background: var(--warning); }

        /* Action Area */
        .action-area {
            padding: 20px 30px;
            background: var(--dark);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .question-text {
            font-size: 1.1rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-text strong {
            color: var(--primary);
        }

        .btn-group {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .btn {
            padding: 14px 32px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #FF8F6B 100%);
            color: white;
            box-shadow: 0 4px 20px var(--primary-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px var(--primary-glow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: var(--surface);
            border-color: var(--primary);
        }

        /* Side Panel */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-card {
            background: var(--surface);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
        }

        .panel-card-header {
            padding: 16px 20px;
            background: var(--surface-light);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-card-body {
            padding: 20px;
        }

        /* Progress Section */
        .level-progress {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .level-dot {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--dark);
            border: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .level-dot.completed {
            background: rgba(0, 212, 170, 0.2);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .level-dot.current {
            background: rgba(255, 107, 53, 0.2);
            border-color: var(--primary);
            color: var(--primary);
            animation: current-pulse 2s infinite;
        }

        @keyframes current-pulse {
            0%, 100% { box-shadow: 0 0 10px var(--primary-glow); }
            50% { box-shadow: 0 0 20px var(--primary-glow); }
        }

        /* Concepts Panel */
        .concept-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--dark);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .concept-item:last-child {
            margin-bottom: 0;
        }

        .concept-icon {
            font-size: 1.2rem;
        }

        .concept-text {
            font-size: 0.8rem;
            line-height: 1.5;
            color: var(--text-muted);
        }

        .concept-text strong {
            color: var(--text);
        }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .achievement {
            aspect-ratio: 1;
            background: var(--dark);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.05);
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            opacity: 1;
            border-color: var(--warning);
            background: rgba(255, 210, 63, 0.1);
        }

        .achievement-icon {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        .achievement-name {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-align: center;
        }

        /* Feedback Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--surface);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modal-pop 0.3s ease;
        }

        @keyframes modal-pop {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .modal-icon.success { color: var(--secondary); }
        .modal-icon.error { color: var(--danger); }
        .modal-icon.trophy { color: var(--warning); }

        .modal h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .modal p {
            color: var(--text-muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .modal .explanation {
            background: var(--dark);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 24px;
            text-align: left;
            font-size: 0.9rem;
            border-left: 3px solid var(--primary);
        }

        .points-earned {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        /* Start Screen */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .start-screen.hidden {
            display: none;
        }

        .start-content {
            text-align: center;
            max-width: 600px;
            padding: 40px;
        }

        .start-logo {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-content h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--warning) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }

        .start-content .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .start-content .course {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 40px;
            letter-spacing: 2px;
        }

        .start-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .feature {
            background: var(--surface);
            padding: 24px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .feature h4 {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .feature p {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .btn-start {
            padding: 18px 60px;
            font-size: 1.1rem;
            animation: glow-pulse 2s infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 4px 20px var(--primary-glow); }
            50% { box-shadow: 0 4px 40px var(--primary-glow); }
        }

        /* Multi-product table */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .product-table th,
        .product-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .product-table th {
            background: var(--dark);
            color: var(--primary);
            font-weight: 700;
        }

        .product-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }

        .product-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .side-panel {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .game-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats-bar {
                width: 100%;
                justify-content: center;
            }
            
            .process-flow {
                flex-direction: column;
            }
            
            .arrow {
                transform: rotate(90deg);
            }
            
            .side-panel {
                grid-template-columns: 1fr;
            }
            
            .start-features {
                grid-template-columns: 1fr;
            }
            
            .start-content h1 {
                font-size: 2rem;
            }
        }

        /* Streak indicator */
        .streak-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--warning) 0%, var(--primary) 100%);
            padding: 12px 24px;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            display: none;
            z-index: 50;
            animation: streak-pop 0.5s ease;
        }

        .streak-indicator.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes streak-pop {
            0% { transform: scale(0) rotate(-10deg); }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(1) rotate(0); }
        }

        /* Capacity calculation panel */
        .calc-panel {
            background: var(--dark);
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .calc-panel h4 {
            font-size: 0.85rem;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.85rem;
        }

        .calc-row:last-child {
            border-bottom: none;
            font-weight: 700;
            color: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <div class="start-content">
            <div class="start-logo">üè≠</div>
            <h1>BOTTLENECK BUSTER</h1>
            <p class="subtitle">Master Process Capacity Analysis</p>
            <p class="course">ISOM 319 ‚Ä¢ OPERATIONS MANAGEMENT ‚Ä¢ SUFFOLK UNIVERSITY</p>
            
            <div class="start-features">
                <div class="feature">
                    <div class="feature-icon">üìä</div>
                    <h4>Single Flow Units</h4>
                    <p>Analyze simple production lines with one product type</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üîÄ</div>
                    <h4>Multi-Product</h4>
                    <p>Handle complex scenarios with multiple flow units</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üèÜ</div>
                    <h4>Achievements</h4>
                    <p>Earn badges and climb the leaderboard</p>
                </div>
            </div>
            
            <button class="btn btn-primary btn-start" onclick="startGame()">
                START GAME
            </button>
        </div>
    </div>

    <!-- Streak Indicator -->
    <div class="streak-indicator" id="streakIndicator">
        <span>üî•</span>
        <span id="streakCount">0</span>
        <span>STREAK!</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="game-header">
            <div class="logo">
                <div class="logo-icon">üè≠</div>
                <div class="logo-text">
                    <h1>BOTTLENECK BUSTER</h1>
                    <span>ISOM 319 ‚Ä¢ SUFFOLK UNIVERSITY</span>
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value" id="levelDisplay">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat">
                    <div class="stat-value score" id="scoreDisplay">0</div>
                    <div class="stat-label">Score</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="accuracyDisplay">--%</div>
                    <div class="stat-label">Accuracy</div>
                </div>
            </div>
        </header>

        <!-- Game Container -->
        <div class="game-container">
            <!-- Main Panel -->
            <div class="main-panel">
                <div class="level-header">
                    <div class="level-info">
                        <h2 id="levelTitle">Level 1: Coffee Shop</h2>
                        <p id="levelSubtitle">Identify the bottleneck in this single-product process</p>
                    </div>
                    <div class="timer" id="timer">
                        <span>‚è±Ô∏è</span>
                        <span id="timerDisplay">60</span>
                    </div>
                </div>

                <div class="process-area">
                    <div class="scenario-description" id="scenarioBox">
                        <h3>üìã Scenario</h3>
                        <p id="scenarioText">Loading scenario...</p>
                    </div>

                    <div class="process-flow" id="processFlow">
                        <!-- Stations will be dynamically generated -->
                    </div>

                    <div id="productTable"></div>
                </div>

                <div class="action-area">
                    <p class="question-text" id="questionText">
                        <strong>Click on the station</strong> that is the bottleneck of this process.
                    </p>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="showHint()">üí° Hint</button>
                        <button class="btn btn-primary" id="submitBtn" onclick="submitAnswer()" disabled>
                            Submit Answer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Side Panel -->
            <div class="side-panel">
                <!-- Progress -->
                <div class="panel-card">
                    <div class="panel-card-header">
                        <span>üìà</span> Level Progress
                    </div>
                    <div class="panel-card-body">
                        <div class="level-progress" id="levelProgress">
                            <!-- Level dots generated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Key Concepts -->
                <div class="panel-card">
                    <div class="panel-card-header">
                        <span>üí°</span> Key Concepts
                    </div>
                    <div class="panel-card-body">
                        <div class="concept-item">
                            <span class="concept-icon">üîç</span>
                            <div class="concept-text">
                                <strong>Bottleneck:</strong> The process step with the <em>lowest capacity</em>, limiting overall throughput.
                            </div>
                        </div>
                        <div class="concept-item">
                            <span class="concept-icon">‚ö°</span>
                            <div class="concept-text">
                                <strong>Capacity:</strong> Maximum output rate (units/hour) a station can handle.
                            </div>
                        </div>
                        <div class="concept-item">
                            <span class="concept-icon">üîÑ</span>
                            <div class="concept-text">
                                <strong>Process Capacity:</strong> Equals the bottleneck capacity - the whole process can't go faster than its slowest step.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements -->
                <div class="panel-card">
                    <div class="panel-card-header">
                        <span>üèÜ</span> Achievements
                    </div>
                    <div class="panel-card-body">
                        <div class="achievements-grid" id="achievementsGrid">
                            <div class="achievement" id="ach-first" title="First Win">
                                <span class="achievement-icon">‚≠ê</span>
                                <span class="achievement-name">First Win</span>
                            </div>
                            <div class="achievement" id="ach-streak3" title="3 Streak">
                                <span class="achievement-icon">üî•</span>
                                <span class="achievement-name">Hot Streak</span>
                            </div>
                            <div class="achievement" id="ach-fast" title="Speed Demon">
                                <span class="achievement-icon">‚ö°</span>
                                <span class="achievement-name">Speed Demon</span>
                            </div>
                            <div class="achievement" id="ach-perfect" title="Perfect Round">
                                <span class="achievement-icon">üíé</span>
                                <span class="achievement-name">Perfect</span>
                            </div>
                            <div class="achievement" id="ach-multi" title="Multi-Master">
                                <span class="achievement-icon">üîÄ</span>
                                <span class="achievement-name">Multi-Master</span>
                            </div>
                            <div class="achievement" id="ach-complete" title="Graduate">
                                <span class="achievement-icon">üéì</span>
                                <span class="achievement-name">Graduate</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-icon" id="modalIcon">‚úÖ</div>
            <h3 id="modalTitle">Correct!</h3>
            <p id="modalMessage">Great job identifying the bottleneck!</p>
            <div class="explanation" id="modalExplanation">
                Explanation will appear here...
            </div>
            <div class="points-earned" id="pointsEarned">+100 points</div>
            <button class="btn btn-primary" onclick="nextLevel()">Continue</button>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            currentLevel: 0,
            score: 0,
            streak: 0,
            correctAnswers: 0,
            totalAnswers: 0,
            selectedStation: null,
            timerInterval: null,
            timeRemaining: 60,
            achievements: new Set(),
            levelStartTime: null
        };

        // Level Data
        const levels = [
            {
                id: 1,
                title: "Level 1: Coffee Shop",
                subtitle: "Identify the bottleneck in this single-product process",
                scenario: "A local coffee shop processes customer orders through three stations. Each barista works at a dedicated station. Find the station limiting the shop's throughput.",
                type: "single",
                stations: [
                    { name: "Order Taking", icon: "üìù", capacity: 45, unit: "orders/hr" },
                    { name: "Coffee Making", icon: "‚òï", capacity: 30, unit: "orders/hr" },
                    { name: "Finishing & Serving", icon: "ü•§", capacity: 50, unit: "orders/hr" }
                ],
                bottleneck: 1,
                explanation: "The Coffee Making station has the lowest capacity at 30 orders/hr. Even though Order Taking can handle 45 orders/hr and Finishing can handle 50 orders/hr, the entire process is limited to 30 orders/hr because coffee making is the slowest step."
            },
            {
                id: 2,
                title: "Level 2: Sandwich Assembly",
                subtitle: "A quick-service restaurant line",
                scenario: "A sandwich shop has a linear assembly process. Customers move down the line as their sandwich is prepared. Which station is causing the queue to build up?",
                type: "single",
                stations: [
                    { name: "Bread Selection", icon: "üçû", capacity: 60, unit: "units/hr" },
                    { name: "Meat & Cheese", icon: "ü•©", capacity: 55, unit: "units/hr" },
                    { name: "Vegetables", icon: "ü•¨", capacity: 40, unit: "units/hr" },
                    { name: "Sauces & Wrap", icon: "üåØ", capacity: 65, unit: "units/hr" }
                ],
                bottleneck: 2,
                explanation: "The Vegetables station with 40 units/hr capacity is the bottleneck. Notice how earlier stations (60, 55) are faster, creating inventory buildup before Vegetables. The final station (65) waits idle because it can't get flow units faster than 40/hr."
            },
            {
                id: 3,
                title: "Level 3: Car Wash",
                subtitle: "Automated service process",
                scenario: "An automated car wash has specialized equipment at each station. The wash cycle time at each station determines how many cars can be processed per hour.",
                type: "single",
                stations: [
                    { name: "Pre-Rinse", icon: "üíß", capacity: 20, unit: "cars/hr" },
                    { name: "Soap & Scrub", icon: "üßº", capacity: 15, unit: "cars/hr" },
                    { name: "High-Pressure Rinse", icon: "üöø", capacity: 25, unit: "cars/hr" },
                    { name: "Dry & Polish", icon: "‚ú®", capacity: 18, unit: "cars/hr" }
                ],
                bottleneck: 1,
                explanation: "Soap & Scrub at 15 cars/hr is the bottleneck. This is a great example of why we shouldn't just look at the first station! The bottleneck can be anywhere in the process. To improve throughput, this car wash should invest in faster scrubbing equipment."
            },
            {
                id: 4,
                title: "Level 4: Electronics Factory",
                subtitle: "Introduction to multi-product analysis",
                scenario: "A factory produces two products (A and B) sharing the same production line. Product A needs 2 min at Assembly while Product B needs 3 min. Use the weighted capacity to find the bottleneck.",
                type: "multi",
                products: [
                    { name: "Product A", color: "a", demand: 20, demandUnit: "units/hr" },
                    { name: "Product B", color: "b", demand: 15, demandUnit: "units/hr" }
                ],
                stations: [
                    { 
                        name: "Component Prep", icon: "üì¶",
                        times: { a: 1.5, b: 2 },
                        unit: "min/unit"
                    },
                    { 
                        name: "Assembly", icon: "üîß",
                        times: { a: 2, b: 3 },
                        unit: "min/unit"
                    },
                    { 
                        name: "Testing", icon: "üî¨",
                        times: { a: 1, b: 1.5 },
                        unit: "min/unit"
                    },
                    { 
                        name: "Packaging", icon: "üì§",
                        times: { a: 1, b: 1 },
                        unit: "min/unit"
                    }
                ],
                bottleneck: 1,
                explanation: "For multi-product processes, we calculate implied utilization. Assembly requires: (20√ó2) + (15√ó3) = 85 min/hr of work, but only has 60 min available. That's 142% utilization‚Äîthe highest‚Äîmaking it the bottleneck. Component Prep needs 60 min (100%), Testing needs 42.5 min (71%), and Packaging needs 35 min (58%)."
            },
            {
                id: 5,
                title: "Level 5: Hospital Lab",
                subtitle: "Critical healthcare process",
                scenario: "A hospital lab processes blood tests and urine tests using shared equipment. Both test types must go through all stations but require different processing times. Patient safety depends on accurate analysis!",
                type: "multi",
                products: [
                    { name: "Blood Tests", color: "a", demand: 25, demandUnit: "tests/hr" },
                    { name: "Urine Tests", color: "b", demand: 20, demandUnit: "tests/hr" }
                ],
                stations: [
                    { 
                        name: "Sample Prep", icon: "üß™",
                        times: { a: 1.2, b: 0.8 },
                        unit: "min/test"
                    },
                    { 
                        name: "Analysis", icon: "üî¨",
                        times: { a: 1.5, b: 1.0 },
                        unit: "min/test"
                    },
                    { 
                        name: "Review", icon: "üë®‚Äç‚öïÔ∏è",
                        times: { a: 0.5, b: 0.5 },
                        unit: "min/test"
                    },
                    { 
                        name: "Reporting", icon: "üìã",
                        times: { a: 0.8, b: 0.7 },
                        unit: "min/test"
                    }
                ],
                bottleneck: 1,
                explanation: "Analysis station requires: (25√ó1.5) + (20√ó1.0) = 57.5 min/hr (96% utilization). Sample Prep needs: (25√ó1.2) + (20√ó0.8) = 46 min/hr (77%). Review needs: 22.5 min/hr (38%). Reporting needs: 34 min/hr (57%). Analysis is the bottleneck at 96% utilization!"
            },
            {
                id: 6,
                title: "Level 6: Pizza Kitchen",
                subtitle: "Multi-product restaurant operation",
                scenario: "A pizzeria makes regular and specialty pizzas. Specialty pizzas need extra prep time for gourmet toppings. The dinner rush is coming‚Äîwhere should you add staff?",
                type: "multi",
                products: [
                    { name: "Regular Pizza", color: "a", demand: 30, demandUnit: "pizzas/hr" },
                    { name: "Specialty Pizza", color: "b", demand: 12, demandUnit: "pizzas/hr" }
                ],
                stations: [
                    { 
                        name: "Dough Stretch", icon: "ü´ì",
                        times: { a: 0.5, b: 0.5 },
                        unit: "min/pizza"
                    },
                    { 
                        name: "Sauce & Cheese", icon: "üßÄ",
                        times: { a: 0.8, b: 1.0 },
                        unit: "min/pizza"
                    },
                    { 
                        name: "Toppings", icon: "üçï",
                        times: { a: 0.7, b: 2.0 },
                        unit: "min/pizza"
                    },
                    { 
                        name: "Oven", icon: "üî•",
                        times: { a: 1.5, b: 1.5 },
                        unit: "min/pizza"
                    },
                    { 
                        name: "Box & Serve", icon: "üì¶",
                        times: { a: 0.3, b: 0.4 },
                        unit: "min/pizza"
                    }
                ],
                bottleneck: 3,
                explanation: "The Oven is the bottleneck! Oven time: (30√ó1.5) + (12√ó1.5) = 63 min/hr (105% - over capacity!). Toppings: (30√ó0.7) + (12√ó2.0) = 45 min/hr (75%). The oven can't keep up with demand. Solutions: add a second oven, reduce bake time, or limit specialty orders during rush."
            },
            {
                id: 7,
                title: "Level 7: Tech Support Center",
                subtitle: "Service operations challenge",
                scenario: "A tech support center handles Basic, Standard, and Premium support tickets. Each tier requires different handling times at each stage. The queue is growing‚Äîfind the constraint!",
                type: "multi",
                products: [
                    { name: "Basic Tickets", color: "a", demand: 40, demandUnit: "tickets/hr" },
                    { name: "Standard Tickets", color: "b", demand: 25, demandUnit: "tickets/hr" },
                    { name: "Premium Tickets", color: "c", demand: 10, demandUnit: "tickets/hr" }
                ],
                stations: [
                    { 
                        name: "Initial Triage", icon: "üìû",
                        times: { a: 0.5, b: 0.8, c: 1.0 },
                        unit: "min/ticket"
                    },
                    { 
                        name: "Tech Analysis", icon: "üíª",
                        times: { a: 0.8, b: 1.5, c: 2.5 },
                        unit: "min/ticket"
                    },
                    { 
                        name: "Resolution", icon: "‚úÖ",
                        times: { a: 0.7, b: 1.2, c: 2.0 },
                        unit: "min/ticket"
                    },
                    { 
                        name: "Documentation", icon: "üìù",
                        times: { a: 0.3, b: 0.5, c: 0.8 },
                        unit: "min/ticket"
                    }
                ],
                bottleneck: 1,
                explanation: "Tech Analysis is the bottleneck at 94.2% utilization! Calculation: (40√ó0.8) + (25√ó1.5) + (10√ó2.5) = 32 + 37.5 + 25 = 94.5 min/hr. Other stations: Triage = 50 min (83%), Resolution = 78 min (130% - WAIT! Actually Resolution is the bottleneck!). Resolution: (40√ó0.7)+(25√ó1.2)+(10√ó2.0) = 28+30+20 = 78 min/hr (130%). This exceeds capacity!"
            },
            {
                id: 8,
                title: "Level 8: Final Challenge",
                subtitle: "Master the multi-product analysis",
                scenario: "An e-commerce fulfillment center processes Small, Medium, and Large packages. Each size requires different handling times. Black Friday is coming‚Äîoptimize now!",
                type: "multi",
                products: [
                    { name: "Small Packages", color: "a", demand: 100, demandUnit: "pkg/hr" },
                    { name: "Medium Packages", color: "b", demand: 60, demandUnit: "pkg/hr" },
                    { name: "Large Packages", color: "c", demand: 25, demandUnit: "pkg/hr" }
                ],
                stations: [
                    { 
                        name: "Receiving", icon: "üì•",
                        times: { a: 0.2, b: 0.3, c: 0.5 },
                        unit: "min/pkg"
                    },
                    { 
                        name: "Picking", icon: "üõí",
                        times: { a: 0.3, b: 0.5, c: 0.8 },
                        unit: "min/pkg"
                    },
                    { 
                        name: "Packing", icon: "üì¶",
                        times: { a: 0.25, b: 0.4, c: 0.7 },
                        unit: "min/pkg"
                    },
                    { 
                        name: "Labeling", icon: "üè∑Ô∏è",
                        times: { a: 0.15, b: 0.2, c: 0.25 },
                        unit: "min/pkg"
                    },
                    { 
                        name: "Loading", icon: "üöö",
                        times: { a: 0.1, b: 0.2, c: 0.4 },
                        unit: "min/pkg"
                    }
                ],
                bottleneck: 1,
                explanation: "Picking is the bottleneck at 83.3% utilization! Picking: (100√ó0.3)+(60√ó0.5)+(25√ó0.8) = 30+30+20 = 80 min/hr. Receiving: 50.5 min (84%), Packing: 66.5 min (111% - ACTUALLY PACKING IS BOTTLENECK!). Packing: (100√ó0.25)+(60√ó0.4)+(25√ó0.7) = 25+24+17.5 = 66.5 min/hr exceeds 60 min capacity = 111% utilization. Add packers!"
            }
        ];

        // Initialize Game
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            loadLevel(0);
            updateProgressDots();
        }

        function loadLevel(levelIndex) {
            const level = levels[levelIndex];
            gameState.currentLevel = levelIndex;
            gameState.selectedStation = null;
            gameState.levelStartTime = Date.now();
            
            // Update UI
            document.getElementById('levelDisplay').textContent = level.id;
            document.getElementById('levelTitle').textContent = level.title;
            document.getElementById('levelSubtitle').textContent = level.subtitle;
            document.getElementById('scenarioText').textContent = level.scenario;
            document.getElementById('submitBtn').disabled = true;
            
            // Reset timer
            resetTimer();
            
            // Render process flow
            renderProcessFlow(level);
            
            // Render product table for multi-product levels
            if (level.type === 'multi') {
                renderProductTable(level);
                document.getElementById('questionText').innerHTML = '<strong>Calculate implied utilization</strong> and click on the bottleneck station.';
            } else {
                document.getElementById('productTable').innerHTML = '';
                document.getElementById('questionText').innerHTML = '<strong>Click on the station</strong> that is the bottleneck of this process.';
            }
            
            updateProgressDots();
        }

        function renderProcessFlow(level) {
            const container = document.getElementById('processFlow');
            container.innerHTML = '';
            
            level.stations.forEach((station, index) => {
                // Add arrow before station (except first)
                if (index > 0) {
                    const arrow = document.createElement('div');
                    arrow.className = 'arrow flow-active';
                    arrow.textContent = '‚Üí';
                    container.appendChild(arrow);
                }
                
                // Create station element
                const stationEl = document.createElement('div');
                stationEl.className = 'station';
                stationEl.dataset.index = index;
                stationEl.onclick = () => selectStation(index);
                
                // Calculate capacity for display
                let capacityDisplay, capacityLabel;
                if (level.type === 'single') {
                    capacityDisplay = station.capacity;
                    capacityLabel = station.unit;
                } else {
                    // For multi-product, show processing times
                    const times = Object.values(station.times);
                    capacityDisplay = times.map(t => t + ' min').join(' / ');
                    capacityLabel = 'per unit (A/B' + (level.products.length > 2 ? '/C' : '') + ')';
                }
                
                // Calculate capacity bar fill percentage
                let fillPercent, fillClass;
                if (level.type === 'single') {
                    const maxCap = Math.max(...level.stations.map(s => s.capacity));
                    const minCap = Math.min(...level.stations.map(s => s.capacity));
                    fillPercent = ((station.capacity - minCap) / (maxCap - minCap)) * 100;
                    fillClass = station.capacity === minCap ? 'low' : station.capacity === maxCap ? 'high' : 'med';
                } else {
                    // For multi-product, calculate implied utilization
                    let totalTime = 0;
                    level.products.forEach((prod, i) => {
                        const key = ['a', 'b', 'c'][i];
                        totalTime += prod.demand * station.times[key];
                    });
                    const utilization = (totalTime / 60) * 100;
                    fillPercent = Math.min(utilization, 100);
                    fillClass = utilization > 90 ? 'low' : utilization > 70 ? 'med' : 'high';
                }
                
                stationEl.innerHTML = `
                    <div class="station-icon">${station.icon}</div>
                    <div class="station-name">${station.name}</div>
                    <div class="station-capacity">${capacityDisplay}</div>
                    <div class="station-capacity-label">${capacityLabel}</div>
                    <div class="capacity-bar">
                        <div class="capacity-fill ${fillClass}" style="width: ${fillPercent}%"></div>
                    </div>
                    ${level.type === 'multi' ? `
                        <div class="product-indicators">
                            ${level.products.map((p, i) => `<div class="product-dot ${['a','b','c'][i]}"></div>`).join('')}
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(stationEl);
            });
        }

        function renderProductTable(level) {
            const container = document.getElementById('productTable');
            
            let tableHTML = `
                <div class="calc-panel">
                    <h4>üìä Demand & Processing Times</h4>
                    <table class="product-table">
                        <tr>
                            <th>Product</th>
                            <th>Demand</th>
                            ${level.stations.map(s => `<th>${s.name}</th>`).join('')}
                        </tr>
            `;
            
            level.products.forEach((product, i) => {
                const key = ['a', 'b', 'c'][i];
                tableHTML += `
                    <tr>
                        <td>
                            <div class="product-label">
                                <div class="product-dot ${key}"></div>
                                ${product.name}
                            </div>
                        </td>
                        <td>${product.demand} ${product.demandUnit}</td>
                        ${level.stations.map(s => `<td>${s.times[key]} min</td>`).join('')}
                    </tr>
                `;
            });
            
            tableHTML += `
                    </table>
                    <p style="margin-top: 12px; font-size: 0.75rem; color: var(--text-muted);">
                        üí° <strong>Hint:</strong> Calculate total time needed at each station: Œ£(demand √ó processing time). 
                        Available time = 60 min/hr. Utilization = Total time / 60. Highest utilization = Bottleneck!
                    </p>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        function selectStation(index) {
            // Remove previous selection
            document.querySelectorAll('.station').forEach(s => s.classList.remove('selected'));
            
            // Select new station
            const station = document.querySelectorAll('.station')[index];
            station.classList.add('selected');
            
            gameState.selectedStation = index;
            document.getElementById('submitBtn').disabled = false;
        }

        function submitAnswer() {
            const level = levels[gameState.currentLevel];
            const isCorrect = gameState.selectedStation === level.bottleneck;
            const timeBonus = Math.max(0, gameState.timeRemaining * 2);
            
            // Stop timer
            clearInterval(gameState.timerInterval);
            
            // Update stats
            gameState.totalAnswers++;
            if (isCorrect) {
                gameState.correctAnswers++;
                gameState.streak++;
                const basePoints = 100;
                const streakBonus = (gameState.streak - 1) * 25;
                const totalPoints = basePoints + streakBonus + timeBonus;
                gameState.score += totalPoints;
                
                // Check achievements
                checkAchievements(timeBonus);
                
                // Show streak indicator
                if (gameState.streak >= 2) {
                    showStreak();
                }
                
                showModal(true, level.explanation, totalPoints);
            } else {
                gameState.streak = 0;
                hideStreak();
                showModal(false, level.explanation, 0);
            }
            
            // Update score display
            document.getElementById('scoreDisplay').textContent = gameState.score;
            updateAccuracy();
            
            // Highlight correct answer
            highlightAnswer(level.bottleneck, isCorrect);
        }

        function highlightAnswer(correctIndex, wasCorrect) {
            const stations = document.querySelectorAll('.station');
            
            if (!wasCorrect && gameState.selectedStation !== null) {
                stations[gameState.selectedStation].classList.add('incorrect');
            }
            
            stations[correctIndex].classList.add('bottleneck-reveal');
            if (wasCorrect) {
                stations[correctIndex].classList.add('correct');
            }
        }

        function showModal(isCorrect, explanation, points) {
            const modal = document.getElementById('modal');
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const message = document.getElementById('modalMessage');
            const explanationEl = document.getElementById('modalExplanation');
            const pointsEl = document.getElementById('pointsEarned');
            
            if (isCorrect) {
                icon.textContent = '‚úÖ';
                icon.className = 'modal-icon success';
                title.textContent = gameState.streak >= 3 ? 'üî• On Fire!' : 'Correct!';
                message.textContent = gameState.streak >= 2 
                    ? `${gameState.streak} in a row! Keep it up!` 
                    : 'Great job identifying the bottleneck!';
                pointsEl.textContent = `+${points} points`;
                pointsEl.style.display = 'block';
            } else {
                icon.textContent = '‚ùå';
                icon.className = 'modal-icon error';
                title.textContent = 'Not Quite!';
                message.textContent = 'Let\'s learn from this one.';
                pointsEl.style.display = 'none';
            }
            
            explanationEl.innerHTML = `<strong>Explanation:</strong> ${explanation}`;
            modal.classList.add('active');
        }

        function nextLevel() {
            document.getElementById('modal').classList.remove('active');
            
            if (gameState.currentLevel < levels.length - 1) {
                loadLevel(gameState.currentLevel + 1);
            } else {
                // Game complete
                showGameComplete();
            }
        }

        function showGameComplete() {
            unlockAchievement('ach-complete');
            
            const modal = document.getElementById('modal');
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const message = document.getElementById('modalMessage');
            const explanationEl = document.getElementById('modalExplanation');
            const pointsEl = document.getElementById('pointsEarned');
            
            icon.textContent = 'üéì';
            icon.className = 'modal-icon trophy';
            title.textContent = 'Congratulations!';
            message.textContent = 'You\'ve mastered capacity analysis and bottleneck identification!';
            explanationEl.innerHTML = `
                <strong>Final Stats:</strong><br>
                Score: ${gameState.score} points<br>
                Accuracy: ${Math.round((gameState.correctAnswers / gameState.totalAnswers) * 100)}%<br>
                Best Streak: ${gameState.streak}<br>
                Achievements: ${gameState.achievements.size}/6
            `;
            pointsEl.textContent = `Total: ${gameState.score} points`;
            pointsEl.style.display = 'block';
            
            // Change button to restart
            modal.querySelector('.btn-primary').textContent = 'Play Again';
            modal.querySelector('.btn-primary').onclick = () => {
                location.reload();
            };
            
            modal.classList.add('active');
        }

        // Timer functions
        function resetTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timeRemaining = 60;
            updateTimerDisplay();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timeRemaining--;
                updateTimerDisplay();
                
                if (gameState.timeRemaining <= 0) {
                    clearInterval(gameState.timerInterval);
                    // Auto-submit with wrong answer if time runs out
                    if (gameState.selectedStation === null) {
                        gameState.selectedStation = -1; // Force wrong
                    }
                    submitAnswer();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timerDisplay');
            display.textContent = gameState.timeRemaining;
            
            if (gameState.timeRemaining <= 10) {
                display.style.color = 'var(--danger)';
            } else if (gameState.timeRemaining <= 20) {
                display.style.color = 'var(--warning)';
            } else {
                display.style.color = 'var(--warning)';
            }
        }

        // Streak indicator
        function showStreak() {
            const indicator = document.getElementById('streakIndicator');
            document.getElementById('streakCount').textContent = gameState.streak;
            indicator.classList.add('active');
        }

        function hideStreak() {
            document.getElementById('streakIndicator').classList.remove('active');
        }

        // Progress dots
        function updateProgressDots() {
            const container = document.getElementById('levelProgress');
            container.innerHTML = '';
            
            levels.forEach((level, index) => {
                const dot = document.createElement('div');
                dot.className = 'level-dot';
                
                if (index < gameState.currentLevel) {
                    dot.classList.add('completed');
                    dot.textContent = '‚úì';
                } else if (index === gameState.currentLevel) {
                    dot.classList.add('current');
                    dot.textContent = level.id;
                } else {
                    dot.textContent = level.id;
                }
                
                container.appendChild(dot);
            });
        }

        // Accuracy
        function updateAccuracy() {
            const accuracy = gameState.totalAnswers > 0 
                ? Math.round((gameState.correctAnswers / gameState.totalAnswers) * 100) 
                : 0;
            document.getElementById('accuracyDisplay').textContent = accuracy + '%';
        }

        // Achievements
        function checkAchievements(timeBonus) {
            // First win
            if (gameState.correctAnswers === 1) {
                unlockAchievement('ach-first');
            }
            
            // 3 streak
            if (gameState.streak >= 3) {
                unlockAchievement('ach-streak3');
            }
            
            // Speed demon (answered in under 15 seconds)
            if (gameState.timeRemaining >= 45) {
                unlockAchievement('ach-fast');
            }
            
            // Perfect (all correct so far)
            if (gameState.correctAnswers === gameState.totalAnswers && gameState.totalAnswers >= 3) {
                unlockAchievement('ach-perfect');
            }
            
            // Multi-master (completed a multi-product level correctly)
            if (levels[gameState.currentLevel].type === 'multi') {
                unlockAchievement('ach-multi');
            }
        }

        function unlockAchievement(id) {
            if (!gameState.achievements.has(id)) {
                gameState.achievements.add(id);
                const el = document.getElementById(id);
                el.classList.add('unlocked');
                
                // Show notification (optional animation)
                el.style.animation = 'none';
                el.offsetHeight; // Trigger reflow
                el.style.animation = 'streak-pop 0.5s ease';
            }
        }

        // Hint system
        function showHint() {
            const level = levels[gameState.currentLevel];
            let hint;
            
            if (level.type === 'single') {
                const capacities = level.stations.map(s => s.capacity);
                const minCap = Math.min(...capacities);
                hint = `üí° Look for the station with the LOWEST capacity. Remember: bottleneck = lowest capacity = ${minCap} units/hr in this case.`;
            } else {
                hint = `üí° For each station, calculate: (Demand_A √ó Time_A) + (Demand_B √ó Time_B)... The station where this sum is closest to or exceeds 60 minutes is your bottleneck!`;
            }
            
            // Deduct points for using hint
            gameState.score = Math.max(0, gameState.score - 20);
            document.getElementById('scoreDisplay').textContent = gameState.score;
            
            alert(hint);
        }

        // Prevent accidental page close
        window.onbeforeunload = function() {
            if (gameState.totalAnswers > 0) {
                return "You have an active game. Are you sure you want to leave?";
            }
        };
    </script>
</body>
</html>
